(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{343:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx基础入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx基础入门"}},[s._v("#")]),s._v(" nginx基础入门")]),s._v(" "),a("h2",{attrs:{id:"nginx常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx常用命令"}},[s._v("#")]),s._v(" nginx常用命令")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("# 进入nginx目录\ncd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sbin\n# 查看nginx版本号\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("/nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v\n\n# 启动nginx\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("/nginx\n\n# 停止nginx\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("/nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s stop\n\n# 重新加载nginx\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("/nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"nginx配置文件简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置文件简介"}},[s._v("#")]),s._v(" nginx配置文件简介")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("# 查看tomcat配置\ncat "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n全局配置\n\n#user nobody；                         #运行用户\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Worker_processes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("               #工作进程数量\n\n#error_log  log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log           #错误日志文件的位置\n\n#pid     log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid                 #"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PID")]),s._v("文件的位置\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("I")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("O")]),s._v("事件配置\n\nevents"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\nuse  epoll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                              #使用epoll模型\n\nworker_connections "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("     #每进程处理"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("个连接\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v("配置\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\ninclude mine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                                              #nginx支持的媒体类型库文件\n\n#include  benet"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf     #配置多个虚拟机主机，把server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("内的内容复制到外面新建的www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf后包含进去     \n\ndefault_type        application"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stranm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" #默认的媒体类型\n\naccess_log   log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log     main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   #访问日志位置\n\nsendfile       on "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    #开启高效传输模式"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("支持文件发送下载"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nkeepalive_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     #连接保持超时\n\n\n\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                                                               #可配置对三个基于域名的虚拟主机\n\nlisten    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       #web服务的监听配置\n\nserver_name   www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("benet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com   #网站名称（"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FQDN")]),s._v("），别名就是在后面再添加网址\n\ncharset  utf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("               #网页的默认字符集\n\nlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n      root   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("           #网站根目录的位置\n\n     error_page    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    #出现对应的http状态码时，使"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html回应客户\n\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n            root     html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        #指定对应的站点目录为html\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n         index index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("php      #默认首页    \n\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br")])]),a("h2",{attrs:{id:"nginx反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx反向代理"}},[s._v("#")]),s._v(" nginx反向代理")]),s._v(" "),a("h3",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("p",[s._v("网站建立后，用户希望只需通过一个url即可访问网站。但是网站所使的服务器可能远不止一台(考虑到用户的访问量在多台服务器上配置tomcat)，所以如何访问通过一个url且还能保证服务器负载均衡的情况下完成用户访问我们的网站呢？nginx的反向代理就是最好的解决方案。 如下图所示，用户通过"),a("code",[s._v("www.xxx.com")]),s._v("交由dns解析到而访问到nginx，此时nginx就是一个反向代理的角色，nginx这时候就会工具服务器详情动态的决定访问哪台服务器。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030024451.png",alt:"image-20220903002420204"}})]),s._v(" "),a("h3",{attrs:{id:"反向代理示例1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理示例1"}},[s._v("#")]),s._v(" 反向代理示例1")]),s._v(" "),a("h4",{attrs:{id:"需求描述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求描述"}},[s._v("#")]),s._v(" 需求描述")]),s._v(" "),a("p",[s._v("打开浏览器，在浏览器地址栏输入地址 "),a("a",{attrs:{href:"http://www.test.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("www.test.com"),a("OutboundLink")],1),s._v(" ，跳转到 linux系统 tomcat 主页中")]),s._v(" "),a("h4",{attrs:{id:"前置步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前置步骤"}},[s._v("#")]),s._v(" 前置步骤")]),s._v(" "),a("p",[s._v("安装tomcat服务器")]),s._v(" "),a("p",[s._v("设置域名重定向")]),s._v(" "),a("p",[s._v("由于本次实验需要通过域名访问nginx然后通过nginx请求tomcat主页并返回，所以为避免dns无法解析我们模拟的域名地址，可以在本机Windows下配置域名解析，具体步骤如下")]),s._v(" "),a("ol",[a("li",[s._v("进入如下目录编辑hosts文件")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("C")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\\"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Windows")]),s._v("\\"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System32")]),s._v("\\drivers\\etc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",[a("li",[s._v("编辑该配置文件，内容如下，这里的ip地址是和本机桥接的虚拟机ip地址")]),s._v(" "),a("li",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030024240.png",alt:"image-20220903002442301"}})])]),s._v(" "),a("h4",{attrs:{id:"nginx配置步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置步骤"}},[s._v("#")]),s._v(" nginx配置步骤")]),s._v(" "),a("p",[s._v("配置nginx请求转发 如下图所示，编辑"),a("code",[s._v("/usr/local/nginx/conf/nginx.conf")]),s._v("将内容改为如下所示")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030025806.png",alt:"image-20220903002502384"}})]),s._v(" "),a("p",[s._v("重启nginx")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("#进入sbin目录输入\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("/nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("查看结果 "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030025517.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"反向代理示例2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理示例2"}},[s._v("#")]),s._v(" 反向代理示例2")]),s._v(" "),a("h4",{attrs:{id:"需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[s._v("#")]),s._v(" 需求")]),s._v(" "),a("p",[s._v("使用 nginx 反向代理，根据访问的路径跳转到不同端口的服务中，nginx 监听端口为 9001。即访问"),a("code",[s._v("192.168.1.29:9001/test1/index.html")]),s._v("和"),a("code",[s._v("192.168.1.29:9001/test2/index.html")]),s._v("访问结果是不同的")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030025867.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h4",{attrs:{id:"步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[s._v("#")]),s._v(" 步骤")]),s._v(" "),a("ol",[a("li",[s._v("增加一台tomcat，如之前所示，注意修改相关端口与之区分，修改的端口如下所示：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030026552.png",alt:"image-20220903002548213"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030025267.png",alt:"在这里插入图片描述"}}),s._v(")"),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030026920.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("ol",[a("li",[s._v("启动tomcat")]),s._v(" "),a("li",[s._v("为两个tomcat配置不同的页面,即在分别在两台tomcat服务器下"),a("code",[s._v("webapp")]),s._v("下,第一台tomcat参见test1目录并添加index网页，第二台tomcat服务器参见test2目录添加index网页。")]),s._v(" "),a("li",[s._v("测试两台tomcat")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030026407.png",alt:"image-20220903002636221"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030026433.png",alt:"image-20220903002653947"}})]),s._v(" "),a("ol",[a("li",[s._v("进行反向代理配置 进入nginx.conf进行如下配置")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("  server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".29")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          proxy_pass   http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          proxy_pass   http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("开放9001端口")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v(" firewall"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cmd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("add"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("permanent\nsystemctl stop firewalld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\nsystemctl start firewalld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("测试")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030028159.png",alt:"image-20220903002810057"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030028558.png",alt:"image-20220903002825015"}})]),s._v(" "),a("h2",{attrs:{id:"负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),a("h3",{attrs:{id:"需求-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求-2"}},[s._v("#")]),s._v(" 需求")]),s._v(" "),a("p",[s._v("浏览器地址栏输入地址 "),a("code",[s._v("http://192.168.1.29/study/index.html")]),s._v(" 请求web页面，nginx会将多个http请求分配到8080或者8081服务器中。")]),s._v(" "),a("h3",{attrs:{id:"步骤-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2"}},[s._v("#")]),s._v(" 步骤")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("准备两台tomcat服务器，并在webapp目录下创建study文件夹，并在文件夹中都创建一个index.html内容随意")])]),s._v(" "),a("li",[a("p",[s._v("开启tomcat测试是否可达")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CMJX%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220903002900385.png",alt:"image-20220903002900385"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030029388.png",alt:"image-20220903002909832"}})])]),s._v(" "),a("li",[a("p",[s._v("配置nginx负载均衡配置 如下所示，"),a("code",[s._v("upstream")]),s._v(" 即负载服务器，下文将"),a("code",[s._v("upstream")]),s._v("起名为myserver，然后在server中配置负载服务器名myserver即可完成负载均衡配置。")])])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v(" upstream myserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".29")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".29")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".29")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        #charset koi8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        #access_log  logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            proxy_pass http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("myserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("ol",[a("li",[a("p",[s._v("测试")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030029013.png",alt:"image-20220903001416365"}})]),s._v(" "),a("h3",{attrs:{id:"nginx-分配服务器策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-分配服务器策略"}},[s._v("#")]),s._v(" nginx 分配服务器策略")]),s._v(" "),a("h4",{attrs:{id:"第一种-轮询-默认"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一种-轮询-默认"}},[s._v("#")]),s._v(" 第一种 轮询（默认）")]),s._v(" "),a("p",[s._v("每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉,则自动剔除。")]),s._v(" "),a("h4",{attrs:{id:"第二种-weight"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二种-weight"}},[s._v("#")]),s._v(" 第二种 weight")]),s._v(" "),a("p",[s._v("weight 代表权重默认为 1, 权重越高被分配的客户端越多")]),s._v(" "),a("h4",{attrs:{id:"第三种-ip-hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三种-ip-hash"}},[s._v("#")]),s._v(" 第三种 ip_hash")]),s._v(" "),a("p",[s._v("每个请求按访问 ip 的 的 hash 结果分配，这样每个访客固定访问一个后端服务器")]),s._v(" "),a("h4",{attrs:{id:"第四种-fair-第三方"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第四种-fair-第三方"}},[s._v("#")]),s._v(" 第四种 fair （第三方）")]),s._v(" "),a("p",[s._v("按后端服务器的响应时间来分配请求，响应时间短的优先分配。")])])]),s._v(" "),a("h2",{attrs:{id:"动静分离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动静分离"}},[s._v("#")]),s._v(" 动静分离")]),s._v(" "),a("p",[s._v("我们都知道请求一个web页面过程中，需要加载动态数据或者静态数据。动态数据变化多端，而静态数据基本不变。动静分离以后我们可以对静态文件进行缓存、或者压缩提高网站性能。")]),s._v(" "),a("h3",{attrs:{id:"模拟实验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模拟实验"}},[s._v("#")]),s._v(" 模拟实验")]),s._v(" "),a("p",[s._v("为了模仿动态文件和静态文件的场景，笔者在/data目录下创建www作为动态文件夹，img为静态文件夹。通过同一个http请求+文件路径模仿动态文件和静态文件的访问过程。")]),s._v(" "),a("h3",{attrs:{id:"配置步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置步骤"}},[s._v("#")]),s._v(" 配置步骤")]),s._v(" "),a("ol",[a("li",[s._v("data文件夹下创建动态文件和静态文件目录并添加文件")]),s._v(" "),a("li",[s._v("nginx添加如下配置")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030029668.png",alt:"image-20220903002941796"}})]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("p",[s._v("测试")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030030900.png",alt:"image-20220903003003145"}})])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030030572.png",alt:"image-20220903003017327"}})]),s._v(" "),a("h2",{attrs:{id:"高可用配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高可用配置"}},[s._v("#")]),s._v(" 高可用配置")]),s._v(" "),a("h3",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),a("p",[s._v("如下图，若只有一台nginx时，常规情况下发起http请求由nginx代理是正常的。当这台nginx服务器出现故障宕机了怎么办呢？ "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030030100.png",alt:"在这里插入图片描述"}}),s._v(" 面对这种情况，我们预想的最好解决方案就是增加一台nginx服务器作为备用代理服务器，从而做到高可用配置。 如下图所示，用户使用192.168.1.50发起请求，若master主服务器正常则会交由主服务器代理http请求，若主服务器出现故障则由备用服务器进行http代理请求")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030030539.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h3",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("ol",[a("li",[s._v("增加一台虚拟机安装nginx服务器")]),s._v(" "),a("li",[s._v("两台虚拟机都安装keepalived")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("yum install keepalived –y\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",[a("li",[s._v("配置keepalived")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("配置keepalived检查主机存货状态脚本\nvim "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx_check"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh \n\n# 粘贴下方内容\n#"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bash\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("`ps "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("C")]),s._v(" nginx –no"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("header "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("wc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l`\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("eq "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("then\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sbin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx\n    sleep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" `ps "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("C")]),s._v(" nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("no"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("header "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("wc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l` "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("eq "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("then\n        killall keepalived\n    fi\nfi\nvim cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf #编辑keepalived的配置文件\n\n# 直接将内容覆盖成如下配置 配置详情可见注释\nglobal_defs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nnotification_email "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nacassen"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@firewall.loc")]),s._v("\nfailover"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@firewall.loc")]),s._v("\nsysadmin"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@firewall.loc")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nnotification_email_from "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Alexandre"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Cassen")]),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@firewall.loc")]),s._v("\nsmtp_server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".150")]),s._v(" #本机ip地址\nsmtp_connect_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\nrouter_id "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LVS_DEVEL")]),s._v(" # 本机设备名称，可使用命令 vim "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("hosts 添加一行 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LVS_DEVEL")]),s._v(" 完成主机id配置\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n# 下方为vrrp协议具体内容可参见百度\nvrrp_script chk_http_port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nscript "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/src/nginx_check.sh"')]),s._v(" # 检查当前服务器是否存货的脚本路径\ninterval "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" #（检测脚本执行的间隔） \nweight "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nvrrp_instance "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VI_1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nstate "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MASTER")]),s._v(" # 备份服务器上将 "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MASTER")]),s._v(" 改为 "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BACKUP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" ens33 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//网卡")]),s._v("\nvirtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" # 主、备机的 virtual_router_id 必须相同\npriority "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nadvert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nauthentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nauth_type "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PASS")]),s._v("\nauth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nvirtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// VRRP H 虚拟地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br")])]),a("ol",[a("li",[s._v("开启nginx")]),s._v(" "),a("li",[s._v("开启keepalive")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("systemctl start keepalived"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",[a("li",[s._v("测试 使用192.168.1.50访问，若可以访问将master主机keepalived以及nginx关闭，再进行访问，关闭命令如下")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("systemctl stop keepalived"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sbin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s stop\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030030238.png",alt:"在这里插入图片描述"}})]),s._v(" "),a("h2",{attrs:{id:"nginx原理解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx原理解析"}},[s._v("#")]),s._v(" nginx原理解析")]),s._v(" "),a("p",[s._v("我们可以使用以下命令可以看到nginx的进程数")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("ps "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ef "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("grep nginx\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030031746.png",alt:"image-20220903003104104"}})]),s._v(" "),a("p",[s._v("可以看出nginx占用了两个进程，一个是master，一个是worker，在我们发起请求到nginx时，nginx的master会收到该请求，并将请求发送给每个worker，所有worker会参与争抢。某个worker得到该请求后，若该请求是个代理请求，worker则会转发该请求到目标服务器。如下图所示： "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/mai-junxuan/Cloud-image/image/202209030031942.png",alt:"在这里插入图片描述"}}),s._v(" 那么问题来了，一个master搭配多个worker的好处有哪些呢？")]),s._v(" "),a("ol",[a("li",[s._v("热部署时，刷新配置不影响正在工作的worker。比如，我们当前这台nginx正在工作。某个worker正在担任某个服务器代理。此时，我们在nginx配置中添加一个新的代理工作。使用 "),a("code",[s._v("./nginx -s reload")]),s._v("完成nginx重新加载，这时候就会又新的worker争抢这份工作。而之前已有工作的worker却不会收到影响。")]),s._v(" "),a("li",[s._v("每个worker是独立的进程。当某个worker出现问题时，其他worker不会收到影响。")])]),s._v(" "),a("p",[s._v("由此我们又会问，那么设置几个worker数为宜呢？ 与cpu数相等即可。比如八核就设置八个。")]),s._v(" "),a("h2",{attrs:{id:"杀死nginx所有进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#杀死nginx所有进程"}},[s._v("#")]),s._v(" 杀死nginx所有进程")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kill -9 $(ps aux | grep 'nginx' | grep -v grep | tr -s ' '| cut -d ' ' -f 2)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"nginx其他问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx其他问题"}},[s._v("#")]),s._v(" nginx其他问题")]),s._v(" "),a("p",[s._v("(1) 发送一个请求时，master会占用worker几个连接数。")]),s._v(" "),a("p",[s._v("当只是请求静态资源时，只有"),a("code",[s._v("请求结果，返回结果")]),s._v("这样一趟也就是两个请求。若作为代理，则是"),a("code",[s._v("master->worker->目标服务器")]),s._v("+"),a("code",[s._v("目标服务器->worker->master")]),s._v("计算箭头数则是4个请求。")]),s._v(" "),a("p",[s._v("(2)假设nginx有一个master，和四个worker ，每个worker支持最大连接数为1024，支持的最大并发数为多少？ 普通静态访问为："),a("code",[s._v("4*1024/2")]),s._v("(除2原因是因为一个静态请求有一趟往返，有一半的连接数处理返回结果了) 反向代理则是 "),a("code",[s._v("4*1024/4")]),s._v("(与上同理)")]),s._v(" "),a("h2",{attrs:{id:"常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[s._v("#")]),s._v(" 常见问题")]),s._v(" "),a("h3",{attrs:{id:"nginx配置不生效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置不生效"}},[s._v("#")]),s._v(" nginx配置不生效")]),s._v(" "),a("h4",{attrs:{id:"问题简述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题简述"}},[s._v("#")]),s._v(" 问题简述")]),s._v(" "),a("p",[s._v("笔者在这段时间进行nginx配置时，进行正确的配置却发现配置没有生效，不断查看配置和reload没有发现问题所在。")]),s._v(" "),a("h4",{attrs:{id:"解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),a("p",[s._v("经过大佬排查很可能是nginx配置没有生效，将nginx所有进程杀死并重启nginx后配置就生效了，所以面对这类这类问题，在一切配置和部署方式都是正确的情况下，我们排查方向要从是否正确运行的方向进行思考。")])])}),[],!1,null,null,null);a.default=e.exports}}]);